// Code generated by gsus-template.
package dao_{{ .PackageName }}

import (
    "context"

    "gorm.io/gorm"
    "{{ .ServicePkgPath }}"
)

var _ dao.{{ .ModelName }} = &{{ .StructName }}{}

//@autowire(dao.{{ .ModelName }},set=dao)
type {{ .StructName }} struct {
}


// 获取{{ .ModelDesc }}列表
func ({{ .CallerIdent }} {{ .StructName }}) Get{{ .ModelName }}List(ctx context.Context, db *gorm.DB, query *{{ .ServicePkg }}.Query{{ .ModelName }}) (list {{ .ServicePkg }}.{{ .ModelName }}List, err error) {
    var res {{ .ModelPkg }}.{{ .ModelName }}Slice
    err = db.Find(&res).Error
    if err != nil {
        return
    }
    res.ForEach(func(index int, m *{{ .ModelPkg }}.{{ .ModelName }}) {
        list = append(list, {{ .ServicePkg }}.{{ .ModelName }}{
            Form{{ .ModelName }}: m.ToForm(),
        })
    })
    return
}

// 通过表单更新{{ .ModelDesc }}
func ({{ .CallerIdent }} {{ .StructName }}) Update{{ .ModelName }}(ctx context.Context, db *gorm.DB, form *{{ .ServicePkg }}.Form{{ .ModelName }}) (id int,err error) {
    m := new({{ .ModelPkg }}.{{ .ModelName }}).FromForm(form)
    if err = db.Save(m).Error;err!=nil{
        return
    }
    id = m.ID
    return
}

// 通过ID删除{{ .ModelDesc }}
func ({{ .CallerIdent }} {{ .StructName }}) Delete{{ .ModelName }}(ctx context.Context, db *gorm.DB, id int) (err error) {
    err = db.Delete(&{{ .ModelPkg }}.{{ .ModelName }}{}, "id = ?", id).Error
    return
}

// 根据ID获取{{ .ModelDesc }}
func ({{ .CallerIdent }} {{ .StructName }}) Get{{ .ModelName }}ByID(ctx context.Context, db *gorm.DB, id int) (ret {{ .ServicePkg }}.{{ .ModelName }},err error) {
    m := new({{ .ModelPkg }}.{{ .ModelName }})
    err = db.Where("id = ?",id).Find(&m).Error
    if err!=nil{
        return
    }
    ret = {{ .ServicePkg }}.{{ .ModelName }}{
        Form{{ .ModelName }}: m.ToForm(),
    }
    return
}
